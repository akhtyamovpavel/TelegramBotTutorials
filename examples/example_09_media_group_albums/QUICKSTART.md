# üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

## –ü—Ä–æ–±–ª–µ–º–∞ –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ

–ù–∞ –≤–∞—à–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç–µ –≤–∏–¥–Ω–æ, —á—Ç–æ –±–æ—Ç **–¥–≤–∞–∂–¥—ã –æ—Ç–ø—Ä–∞–≤–∏–ª —Å–æ–æ–±—â–µ–Ω–∏–µ** "–ü–æ–ª—É—á–µ–Ω –∞–ª—å–±–æ–º!" –¥–ª—è –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –∞–ª—å–±–æ–º–∞ –∏–∑ 2 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π.

–≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Ç–æ–º—É, —á—Ç–æ:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞–ª—å–±–æ–º –∏–∑ 2 —Ñ–æ—Ç–æ
2. Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –±–æ—Ç—É 2 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º `media_group_id`
3. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–ª—è **–∫–∞–∂–¥–æ–≥–æ** —Ñ–æ—Ç–æ
4. –†–µ–∑—É–ª—å—Ç–∞—Ç: 2 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –æ—Ç–≤–µ—Ç–∞ ‚ùå

## ‚úÖ –†–µ—à–µ–Ω–∏–µ –∑–∞ 3 —à–∞–≥–∞

### –®–∞–≥ 1: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã —Å middleware

–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à—É –±–∏–±–ª–∏–æ—Ç–µ–∫—É:

**–î–ª—è aiogram:**
```bash
cd examples/example_09_media_group_albums/aiogram
export BOT_TOKEN="your_token"
python bot_with_middleware.py
```

**–î–ª—è python-telegram-bot:**
```bash
cd examples/example_09_media_group_albums/python_telegram_bot
export BOT_TOKEN="your_token"
python bot_with_middleware.py
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ç–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (–∞–ª—å–±–æ–º)
2. –ë–æ—Ç –æ—Ç–≤–µ—Ç–∏—Ç **–û–î–ò–ù –†–ê–ó** ‚úÖ
3. –°–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å: "‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ middleware - –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è!"

### –®–∞–≥ 3: –ü–æ–Ω–∏–º–∞–Ω–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø–æ–Ω—è—Ç—å, –∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- **[MIDDLEWARE.md](./MIDDLEWARE.md)** - –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

## üìÅ –§–∞–π–ª—ã

### aiogram
- `bot.py` - ‚ùå –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è (—Å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º)
- `bot_with_middleware.py` - ‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è
- `album_middleware.py` - middleware –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏

### python-telegram-bot
- `bot.py` - ‚ùå –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è (—Å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º)
- `bot_with_middleware.py` - ‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è
- `album_middleware.py` - middleware –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏

## üîë –ö–ª—é—á–µ–≤–æ–π –∫–æ–¥

### aiogram

```python
from album_middleware import AlbumMiddleware

router = Router()

# –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º middleware
router.message.middleware(AlbumMiddleware(latency=0.3))

@router.message(F.media_group_id, F.photo)
async def handle_album(message: Message, album: List[Message] = None):
    """–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –û–î–ò–ù –†–ê–ó –¥–ª—è –≤—Å–µ–≥–æ –∞–ª—å–±–æ–º–∞"""
    if album is None:
        album = [message]

    photos = [msg.photo[-1] for msg in album if msg.photo]

    await message.answer(
        f"–ü–æ–ª—É—á–µ–Ω –∞–ª—å–±–æ–º –∏–∑ {len(photos)} —Ñ–æ—Ç–æ!\n"
        "‚úÖ –ë–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è!"
    )
```

### python-telegram-bot

```python
from album_middleware import AlbumCollector, get_album_messages

album_collector = AlbumCollector(latency=0.3)

async def handle_album(update: Update, context):
    """–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –û–î–ò–ù –†–ê–ó –¥–ª—è –≤—Å–µ–≥–æ –∞–ª—å–±–æ–º–∞"""
    album_updates = get_album_messages(update, context)

    if album_updates is None:
        album_updates = [update]

    photos = [upd.effective_message.photo[-1] for upd in album_updates
              if upd.effective_message.photo]

    await update.effective_message.reply_text(
        f"–ü–æ–ª—É—á–µ–Ω –∞–ª—å–±–æ–º –∏–∑ {len(photos)} —Ñ–æ—Ç–æ!\n"
        "‚úÖ –ë–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è!"
    )

# –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
wrapped_handler = album_collector.wrap_handler(handle_album)

application.add_handler(
    MessageHandler(filters.PHOTO & ~filters.FORWARDED, wrapped_handler)
)
```

## üí° –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

1. **Middleware –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç** –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å `media_group_id`
2. **–î–æ–±–∞–≤–ª—è–µ—Ç –≤ –±—É—Ñ–µ—Ä** –≤–º–µ—Å—Ç–æ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
3. **–ó–∞–ø—É—Å–∫–∞–µ—Ç —Ç–∞–π–º–µ—Ä** (0.3 —Å–µ–∫—É–Ω–¥—ã)
4. –ö–æ–≥–¥–∞ –Ω–æ–≤–æ–µ —Ñ–æ—Ç–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç ‚Üí **–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç–∞–π–º–µ—Ä**
5. –ö–æ–≥–¥–∞ —Ç–∞–π–º–µ—Ä –∏—Å—Ç–µ–∫–∞–µ—Ç ‚Üí **–≤—ã–∑—ã–≤–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –û–î–ò–ù –†–ê–ó** —Å–æ –≤—Å–µ–º–∏ —Ñ–æ—Ç–æ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–ª—É—á–∞–µ—Ç –≤—Å–µ —Ñ–æ—Ç–æ –∞–ª—å–±–æ–º–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –æ–¥–∏–Ω —Ä–∞–∑!

## ‚ùì –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ production?**
A: –î–∞! –≠—Ç–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è production –±–æ—Ç–æ–≤.

**Q: –ö–∞–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ latency –≤—ã–±—Ä–∞—Ç—å?**
A: 0.3-0.5 —Å–µ–∫—É–Ω–¥—ã –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ. –ú–µ–Ω—å—à–µ - –º–æ–∂–µ—Ç –Ω–µ —Å–æ–±—Ä–∞—Ç—å –≤—Å–µ —Ñ–æ—Ç–æ, –±–æ–ª—å—à–µ - –º–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è.

**Q: –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –¥–ª—è –≤–∏–¥–µ–æ?**
A: –î–∞, —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ª—é–±—ã—Ö —Ç–∏–ø–æ–≤ Media Group (—Ñ–æ—Ç–æ, –≤–∏–¥–µ–æ, –¥–æ–∫—É–º–µ–Ω—Ç—ã).

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–π –∫–æ–¥ –±–µ–∑ middleware?**
A: –ú–æ–∂–Ω–æ, –Ω–æ –±—É–¥–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤. –î–ª—è —É—á–µ–±–Ω—ã—Ö —Ü–µ–ª–µ–π - –¥–∞, –¥–ª—è production - –Ω–µ—Ç.

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

- **[README.md](./README.md)** - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ Media Group
- **[MIDDLEWARE.md](./MIDDLEWARE.md)** - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ middleware
- **[bot.py](./aiogram/bot.py)** - –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
