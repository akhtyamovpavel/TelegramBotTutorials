# Example 9: Telegram Payments (–ü–æ–∫—É–ø–∫–∏ –∑–∞ –∑–≤–µ–∑–¥—ã)

## üéØ –ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ

–í –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö –º—ã –Ω–∞—É—á–∏–ª–∏—Å—å:
- –†–∞–±–æ—Ç–∞—Ç—å —Å —Ñ–∞–π–ª–∞–º–∏, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –∏ –∞–ª—å–±–æ–º–∞–º–∏
- –°–æ–∑–¥–∞–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Å –∫–Ω–æ–ø–∫–∞–º–∏

**–ù–æ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:**
- **Telegram Stars** - –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –≤–∞–ª—é—Ç–∞ Telegram –¥–ª—è –æ–ø–ª–∞—Ç—ã
- **–°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–≤–æ–π—Å–æ–≤** - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å—á–µ—Ç–æ–≤ –Ω–∞ –æ–ø–ª–∞—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- **Pre-checkout query** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –æ–ø–ª–∞—Ç–æ–π
- **Successful payment** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã
- **Refund** - –≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- **Paid media** - –ø–ª–∞—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –≤–∏–¥–µ–æ)

## üìö –ö–æ–Ω—Ü–µ–ø—Ü–∏–∏

### –ß—Ç–æ —Ç–∞–∫–æ–µ Telegram Stars?

**Telegram Stars** (‚≠ê) - —ç—Ç–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –≤–∞–ª—é—Ç–∞ Telegram, –∫–æ—Ç–æ—Ä—É—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø–æ–∫—É–ø–∞—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –æ–ø–ª–∞—Ç—ã —Ç–æ–≤–∞—Ä–æ–≤ –∏ —É—Å–ª—É–≥ –≤ –±–æ—Ç–∞—Ö.

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–∫—É–ø–∞—é—Ç –∑–≤–µ–∑–¥—ã –∑–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–µ–Ω—å–≥–∏
- –ë–æ—Ç—ã –ø–æ–ª—É—á–∞—é—Ç –∑–≤–µ–∑–¥—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å—Ä–µ–¥—Å—Ç–≤ (refund)
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤–Ω–µ—à–Ω–∏—Ö –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
- –†–∞–±–æ—Ç–∞–µ—Ç –≤–æ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∞—Ö, –≥–¥–µ –¥–æ—Å—Ç—É–ø–µ–Ω Telegram

### –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –ò–ò-–±–æ—Ç–æ–≤?

1. **–ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è** - –ø—Ä–æ–¥–∞–∂–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ò–ò-–º–æ–¥–µ–ª—è–º
2. **–ü–ª–∞—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, —Ç–µ–∫—Å—Ç–∞ –∑–∞ –ø–ª–∞—Ç—É
3. **–ü–æ–¥–ø–∏—Å–∫–∏** - –µ–∂–µ–º–µ—Å—è—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –ø—Ä–µ–º–∏—É–º-—Ñ—É–Ω–∫—Ü–∏—è–º
4. **–ú–∏–∫—Ä–æ—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** - –æ–ø–ª–∞—Ç–∞ –∑–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∫ –º–æ–¥–µ–ª–∏
5. **Paid media** - –ø—Ä–æ–¥–∞–∂–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

## üîÑ –†–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏

| –§—É–Ω–∫—Ü–∏—è | aiogram 3.x | python-telegram-bot 20.x |
|---------|-------------|--------------------------|
| **–û—Ç–ø—Ä–∞–≤–∫–∞ –∏–Ω–≤–æ–π—Å–∞** | `bot.send_invoice()` | `bot.send_invoice()` |
| **Pre-checkout** | `@router.pre_checkout_query()` | `PreCheckoutQueryHandler` |
| **Successful payment** | `F.successful_payment` | `filters.SUCCESSFUL_PAYMENT` |
| **–í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤** | `bot.refund_star_payment()` | `bot.refund_star_payment()` |
| **–í–∞–ª—é—Ç–∞ Stars** | `currency="XTR"` | `currency="XTR"` |

## üìñ –¢–µ–æ—Ä–∏—è: –ü—Ä–æ—Ü–µ—Å—Å –æ–ø–ª–∞—Ç—ã

### –®–∞–≥–∏ –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ Telegram Stars:

1. **–°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–≤–æ–π—Å–∞** - –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—á–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
2. **–ù–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ –æ–ø–ª–∞—Ç—ã** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "Pay X ‚≠ê"
3. **Pre-checkout query** - –±–æ—Ç –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å–ª–æ–≤–∏—è –ø–µ—Ä–µ–¥ –æ–ø–ª–∞—Ç–æ–π
4. **–û–ø–ª–∞—Ç–∞** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —Å–ø–∏—Å–∞–Ω–∏–µ –∑–≤–µ–∑–¥
5. **Successful payment** - –±–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–µ
6. **–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —É—Å–ª—É–≥–∏** - –±–æ—Ç –≤—ã–¥–∞–µ—Ç –¥–æ—Å—Ç—É–ø/–∫–æ–Ω—Ç–µ–Ω—Ç

### aiogram: –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–≤–æ–π—Å–∞

```python
from aiogram.types import LabeledPrice

@router.message(Command("buy"))
async def send_invoice(message: Message, bot: Bot):
    await bot.send_invoice(
        chat_id=message.chat.id,
        title="–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ò–ò",
        description="–°–æ–∑–¥–∞–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –ø–æ–º–æ—â—å—é Stable Diffusion",
        payload="ai_image_generation",  # –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π ID
        currency="XTR",  # Telegram Stars
        prices=[
            LabeledPrice(label="–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è", amount=10)  # 10 –∑–≤–µ–∑–¥
        ]
    )
```

### python-telegram-bot: –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–≤–æ–π—Å–∞

```python
from telegram import LabeledPrice

async def buy_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await context.bot.send_invoice(
        chat_id=update.effective_chat.id,
        title="–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ò–ò",
        description="–°–æ–∑–¥–∞–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –ø–æ–º–æ—â—å—é Stable Diffusion",
        payload="ai_image_generation",
        currency="XTR",
        prices=[
            LabeledPrice(label="–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è", amount=10)
        ]
    )
```

## üìñ –¢–µ–æ—Ä–∏—è: Pre-checkout Query

**Pre-checkout query** - —ç—Ç–æ callback, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è **–¥–æ** —Å–ø–∏—Å–∞–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤. –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
- –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∞–≤
- –ù–µ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏ –ª–∏–º–∏—Ç –ø–æ–∫—É–ø–æ–∫
- –î–æ—Å—Ç—É–ø–Ω–∞ –ª–∏ —É—Å–ª—É–≥–∞ –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç

### aiogram: –û–±—Ä–∞–±–æ—Ç–∫–∞ pre-checkout

```python
@router.pre_checkout_query()
async def process_pre_checkout_query(
    pre_checkout_query: PreCheckoutQuery,
    bot: Bot
):
    # –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏
    # –ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –ª–∏–º–∏—Ç—ã

    # –ï—Å–ª–∏ –≤—Å–µ OK, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º
    await bot.answer_pre_checkout_query(
        pre_checkout_query.id,
        ok=True
    )

    # –ï—Å–ª–∏ –æ—à–∏–±–∫–∞, –æ—Ç–∫–ª–æ–Ω—è–µ–º —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º
    # await bot.answer_pre_checkout_query(
    #     pre_checkout_query.id,
    #     ok=False,
    #     error_message="–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ø–æ–∫—É–ø–æ–∫ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è"
    # )
```

### python-telegram-bot: –û–±—Ä–∞–±–æ—Ç–∫–∞ pre-checkout

```python
async def precheckout_callback(
    update: Update,
    context: ContextTypes.DEFAULT_TYPE
):
    query = update.pre_checkout_query

    # –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –æ–ø–ª–∞—Ç–æ–π
    # ...

    # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º
    await query.answer(ok=True)

    # –ò–ª–∏ –æ—Ç–∫–ª–æ–Ω—è–µ–º
    # await query.answer(ok=False, error_message="–û—à–∏–±–∫–∞")
```

## üìñ –¢–µ–æ—Ä–∏—è: Successful Payment

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã –±–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å `successful_payment`.

### aiogram: –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã

```python
@router.message(F.successful_payment)
async def process_successful_payment(message: Message, bot: Bot):
    payment = message.successful_payment

    logger.info(
        f"–£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞ –æ—Ç {message.from_user.id}: "
        f"{payment.total_amount} {payment.currency}"
    )

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞
    telegram_payment_charge_id = payment.telegram_payment_charge_id

    # –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º —É—Å–ª—É–≥—É
    if payment.invoice_payload == "ai_image_generation":
        await message.answer("üé® –ì–µ–Ω–µ—Ä–∏—Ä—É—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ...")
        # ... –≥–µ–Ω–µ—Ä–∞—Ü–∏—è ...
        await message.answer_photo(generated_image)
```

### python-telegram-bot: –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã

```python
async def successful_payment_callback(
    update: Update,
    context: ContextTypes.DEFAULT_TYPE
):
    payment = update.message.successful_payment

    logger.info(
        f"–£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞: {payment.total_amount} {payment.currency}"
    )

    # –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º —É—Å–ª—É–≥—É
    if payment.invoice_payload == "ai_image_generation":
        await update.message.reply_text("üé® –ì–µ–Ω–µ—Ä–∏—Ä—É—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ...")
        # ... –≥–µ–Ω–µ—Ä–∞—Ü–∏—è ...
```

## üìñ –¢–µ–æ—Ä–∏—è: –í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ (Refund)

–ë–æ—Ç –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:

### aiogram: –í–æ–∑–≤—Ä–∞—Ç

```python
@router.message(Command("refund"))
async def refund_payment(message: Message, bot: Bot):
    # –ü–æ–ª—É—á–∞–µ–º telegram_payment_charge_id –∏–∑ –ë–î
    payment_id = get_last_payment_id(message.from_user.id)

    result = await bot.refund_star_payment(
        user_id=message.from_user.id,
        telegram_payment_charge_id=payment_id
    )

    if result:
        await message.answer("üí∞ –°—Ä–µ–¥—Å—Ç–≤–∞ –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã!")
```

### python-telegram-bot: –í–æ–∑–≤—Ä–∞—Ç

```python
async def refund_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    payment_id = get_last_payment_id(update.effective_user.id)

    result = await context.bot.refund_star_payment(
        user_id=update.effective_user.id,
        telegram_payment_charge_id=payment_id
    )

    if result:
        await update.message.reply_text("üí∞ –°—Ä–µ–¥—Å—Ç–≤–∞ –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã!")
```

## üé® –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –¥–ª—è –ò–ò

### 1. –ü–ª–∞—Ç–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

```python
# –¶–µ–Ω—ã –Ω–∞ —Ä–∞–∑–Ω—ã–µ –º–æ–¥–µ–ª–∏
PRICES = {
    "stable_diffusion": LabeledPrice(label="Stable Diffusion", amount=5),
    "dalle": LabeledPrice(label="DALL-E", amount=10),
    "midjourney_style": LabeledPrice(label="Midjourney Style", amount=15),
}

@router.message(Command("generate_paid"))
async def paid_generation(message: Message, bot: Bot):
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã
    builder = InlineKeyboardBuilder()
    builder.button(text="SD (5‚≠ê)", callback_data="pay_stable_diffusion")
    builder.button(text="DALL-E (10‚≠ê)", callback_data="pay_dalle")
    builder.button(text="MJ Style (15‚≠ê)", callback_data="pay_midjourney_style")

    await message.answer(
        "–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:",
        reply_markup=builder.as_markup()
    )

@router.callback_query(F.data.startswith("pay_"))
async def send_payment_invoice(callback: CallbackQuery, bot: Bot):
    model = callback.data.replace("pay_", "")

    await bot.send_invoice(
        chat_id=callback.message.chat.id,
        title=f"–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è - {model}",
        description="–°–æ–∑–¥–∞–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è",
        payload=f"generate_{model}",
        currency="XTR",
        prices=[PRICES[model]]
    )
```

### 2. –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ø—Ä–µ–º–∏—É–º-—Ñ—É–Ω–∫—Ü–∏–∏

```python
@router.message(Command("premium"))
async def premium_subscription(message: Message, bot: Bot):
    await bot.send_invoice(
        chat_id=message.chat.id,
        title="–ü—Ä–µ–º–∏—É–º –ø–æ–¥–ø–∏—Å–∫–∞",
        description="30 –¥–Ω–µ–π –±–µ–∑–ª–∏–º–∏—Ç–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π",
        payload="premium_30days",
        currency="XTR",
        prices=[
            LabeledPrice(label="–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ 30 –¥–Ω–µ–π", amount=100)
        ]
    )

@router.message(F.successful_payment)
async def activate_premium(message: Message):
    payment = message.successful_payment

    if payment.invoice_payload == "premium_30days":
        # –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–æ–¥–ø–∏—Å–∫—É –≤ –ë–î
        activate_user_premium(
            user_id=message.from_user.id,
            days=30
        )

        await message.answer(
            "üéâ –ü—Ä–µ–º–∏—É–º –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –Ω–∞ 30 –¥–Ω–µ–π!\n\n"
            "–¢–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω—ã:\n"
            "‚Ä¢ –ë–µ–∑–ª–∏–º–∏—Ç–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è\n"
            "‚Ä¢ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞\n"
            "‚Ä¢ –≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –º–æ–¥–µ–ª–∏"
        )
```

### 3. –ü–ª–∞—Ç–Ω—ã–µ –º–µ–¥–∏–∞ (Paid Media)

```python
from aiogram.types import InputPaidMediaPhoto, FSInputFile

@router.message(Command("buy_art"))
async def send_paid_media(message: Message, bot: Bot):
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–ª–∞—Ç–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    await bot.send_paid_media(
        chat_id=message.chat.id,
        star_count=20,  # –°—Ç–æ–∏–º–æ—Å—Ç—å –≤ –∑–≤–µ–∑–¥–∞—Ö
        media=[
            InputPaidMediaPhoto(
                media=FSInputFile("exclusive_art_1.jpg")
            ),
            InputPaidMediaPhoto(
                media=FSInputFile("exclusive_art_2.jpg")
            ),
        ],
        caption="üé® –≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ —Ä–∞–±–æ—Ç—ã –ò–ò-—Ö—É–¥–æ–∂–Ω–∏–∫–∞",
        show_caption_above_media=True
    )
```

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–º–µ—Ä–æ–≤

### aiogram –≤–µ—Ä—Å–∏—è
```bash
export BOT_TOKEN="your_bot_token"
python examples/example_09_telegram_payments/aiogram/bot.py
```

### python-telegram-bot –≤–µ—Ä—Å–∏—è
```bash
export BOT_TOKEN="your_bot_token"
python examples/example_09_telegram_payments/python_telegram_bot/bot.py
```

## üìù –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

- `/start` - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- `/buy_basic` - –ö—É–ø–∏—Ç—å –±–∞–∑–æ–≤—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é (5‚≠ê)
- `/buy_premium` - –ö—É–ø–∏—Ç—å –ø—Ä–µ–º–∏—É–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é (10‚≠ê)
- `/buy_pack` - –ö—É–ø–∏—Ç—å –ø–∞–∫–µ—Ç –∏–∑ 10 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π (40‚≠ê)
- `/refund` - –í–µ—Ä–Ω—É—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –ø–æ–∫—É–ø–∫—É

## üéì –ß—Ç–æ –∏–∑—É—á–∏–ª–∏

1. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–≤–æ–π—Å–æ–≤ –¥–ª—è –æ–ø–ª–∞—Ç—ã Telegram Stars
2. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ pre-checkout query
3. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
4. ‚úÖ –í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
5. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–µ–π —Å –ò–ò-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

### –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è:

1. **–í–∞–ª—é—Ç–∞**: –î–ª—è Telegram Stars –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `currency="XTR"`
2. **provider_token**: –î–ª—è Stars –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É `""`
3. **–¶–µ–Ω—ã**: –£–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ –∑–≤–µ–∑–¥–∞—Ö (1 –∑–≤–µ–∑–¥–∞ = amount=1)
4. **–í–æ–∑–≤—Ä–∞—Ç**: –ú–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ 30 –¥–Ω–µ–π

### –õ–∏–º–∏—Ç—ã:

- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞: 1 –∑–≤–µ–∑–¥–∞
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞: 10000 –∑–≤–µ–∑–¥
- –í–æ–∑–≤—Ä–∞—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Ç–µ—á–µ–Ω–∏–µ 30 –¥–Ω–µ–π

### –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏:

1. **–°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ payment_charge_id** –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ payload** –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ç–∏–ø–∞ –ø–ª–∞—Ç–µ–∂–∞
3. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –≤ pre-checkout** –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —É—Å–ª—É–≥–∏
4. **–õ–æ–≥–∏—Ä—É–π—Ç–µ –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** –¥–ª—è –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏
5. **–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–π—Ç–µ —É—Å–ª—É–≥—É —Å—Ä–∞–∑—É** –ø–æ—Å–ª–µ successful_payment

## üí∞ –ü—Ä–∏–º–µ—Ä—ã —Ü–µ–Ω –¥–ª—è –ò–ò-—É—Å–ª—É–≥

| –£—Å–ª—É–≥–∞ | –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Ü–µ–Ω–∞ |
|--------|-------------------|
| –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ (GPT) | 1-3 ‚≠ê |
| –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (SD) | 5-10 ‚≠ê |
| –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (DALL-E) | 10-15 ‚≠ê |
| OCR —Ç–µ–∫—Å—Ç–∞ | 2-5 ‚≠ê |
| –£–ª—É—á—à–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è | 5-8 ‚≠ê |
| –í–∏–¥–µ–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è | 20-50 ‚≠ê |
| –ú–µ—Å—è—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ | 50-200 ‚≠ê |

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

- **Example 7** - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–º–æ–∂–Ω–æ –º–æ–Ω–µ—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å)
- **Example 8** - –ê–ª—å–±–æ–º—ã (–º–æ–∂–Ω–æ –ø—Ä–æ–¥–∞–≤–∞—Ç—å –∫–∞–∫ paid media)
- **Example 6** - –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ (–ø–ª–∞—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞)

---

**–°–æ–≤–µ—Ç –¥–ª—è –ò–ò-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:** Telegram Stars - –æ—Ç–ª–∏—á–Ω—ã–π —Å–ø–æ—Å–æ–± –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏ –±–æ—Ç–æ–≤ –±–µ–∑ —Å–ª–æ–∂–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º. –ù–∞—á–Ω–∏—Ç–µ —Å –Ω–µ–±–æ–ª—å—à–∏—Ö —Ü–µ–Ω –∏ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å–ø—Ä–æ—Å –Ω–∞ –≤–∞—à–∏ –ò–ò-—É—Å–ª—É–≥–∏!
