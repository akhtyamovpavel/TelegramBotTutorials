# Example 6: –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ (–¥–ª—è –ò–ò-–º–æ–¥–µ–ª–µ–π)

## –û–ø–∏—Å–∞–Ω–∏–µ

–ë–æ—Ç –¥–ª—è –ø—Ä–∏–µ–º–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ò–ò-–º–æ–¥–µ–ª—è–º–∏:
- üì∑ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ (–¥–ª—è –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–≥–æ –∑—Ä–µ–Ω–∏—è, OCR)
- üìÑ –î–æ–∫—É–º–µ–Ω—Ç—ã (PDF, DOCX, TXT –¥–ª—è NLP)
- üéµ –ê—É–¥–∏–æ (–¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏, –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ—á–∏)
- üé¨ –í–∏–¥–µ–æ (–¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –≤–∏–¥–µ–æ, –¥–µ—Ç–µ–∫—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤)
- üé§ –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–¥–ª—è Speech-to-Text)

## –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –ò–ò?

### –¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:
1. **–ö–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–µ –∑—Ä–µ–Ω–∏–µ** - –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏, –¥–µ—Ç–µ–∫—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤
2. **NLP –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –∑–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
3. **Speech-to-Text** - —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –∞—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤ (Whisper, Vosk)
4. **OCR** - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (Tesseract, EasyOCR)
5. **–í–∏–¥–µ–æ-–∞–Ω–∞–ª–∏–∑** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ –∫–∞–¥—Ä –∑–∞ –∫–∞–¥—Ä–æ–º
6. **–î–∞—Ç–∞—Å–µ—Ç—ã** - —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π

## –ß—Ç–æ –Ω–æ–≤–æ–≥–æ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏

### ‚ûï –î–æ–±–∞–≤–ª–µ–Ω–æ:
1. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤** - —Ñ–æ—Ç–æ, –¥–æ–∫—É–º–µ–Ω—Ç—ã, –∞—É–¥–∏–æ, –≤–∏–¥–µ–æ
2. **–°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤** - `bot.download()` / `file.download_to_drive()`
3. **–ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö** - —Ä–∞–∑–º–µ—Ä, —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
4. **–§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞** - —Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–ø–æ–∫
5. **–§–∏–ª—å—Ç—Ä—ã –ø–æ —Ç–∏–ø–∞–º** - `F.photo`, `F.document`, `filters.PHOTO`

### –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:
- –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π (Path, makedirs)
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install aiogram
# –∏–ª–∏
pip install python-telegram-bot
```

## –ó–∞–ø—É—Å–∫

```bash
export BOT_TOKEN="your_bot_token_here"

# aiogram
python examples/example_06_file_upload/aiogram/bot.py

# python-telegram-bot
python examples/example_06_file_upload/python_telegram_bot/bot.py
```

## –ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

### 1. –¢–∏–ø—ã —Ñ–∞–π–ª–æ–≤ –≤ Telegram

| –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ |
|-----|----------|--------------|---------------|
| **photo** | –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è | 10 –ú–ë (—Å–∂–∞—Ç—ã–µ) | CV, OCR |
| **document** | –§–∞–π–ª—ã –±–µ–∑ —Å–∂–∞—Ç–∏—è | 20 –ú–ë / 50 –ú–ë* | –õ—é–±—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã |
| **audio** | –ê—É–¥–∏–æ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ | 20 –ú–ë / 50 –ú–ë* | –ú—É–∑—ã–∫–∞ |
| **voice** | –ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ | - | Speech-to-Text |
| **video** | –í–∏–¥–µ–æ—Ñ–∞–π–ª—ã | 20 –ú–ë / 50 –ú–ë* | –í–∏–¥–µ–æ-–∞–Ω–∞–ª–∏–∑ |
| **video_note** | –í–∏–¥–µ–æ-–∫—Ä—É–∂–æ—á–∫–∏ | - | –ö–æ—Ä–æ—Ç–∫–∏–µ –≤–∏–¥–µ–æ |

*50 –ú–ë –¥–ª—è Premium –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### 2. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

**aiogram:**
```python
# –ü–æ–ª—É—á–∞–µ–º file_id –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è
photo = message.photo[-1]  # –°–∞–º–æ–µ –±–æ–ª—å—à–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ

# –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
file_path = Path("downloads/photo.jpg")
await bot.download(photo, destination=file_path)

# –ò–ª–∏ –ø–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ
file_info = await bot.get_file(photo.file_id)
file_size = file_info.file_size
```

**python-telegram-bot:**
```python
# –ü–æ–ª—É—á–∞–µ–º file_id
photo = update.message.photo[-1]

# –ü–æ–ª—É—á–∞–µ–º –æ–±—ä–µ–∫—Ç File
file = await context.bot.get_file(photo.file_id)

# –°–∫–∞—á–∏–≤–∞–µ–º
await file.download_to_drive("downloads/photo.jpg")
```

### 3. –§–∏–ª—å—Ç—Ä—ã –ø–æ —Ç–∏–ø–∞–º —Ñ–∞–π–ª–æ–≤

**aiogram:**
```python
@router.message(F.photo)
async def handle_photo(message: Message): ...

@router.message(F.document)
async def handle_document(message: Message): ...

@router.message(F.audio)
async def handle_audio(message: Message): ...

@router.message(F.video)
async def handle_video(message: Message): ...

@router.message(F.voice)
async def handle_voice(message: Message): ...
```

**python-telegram-bot:**
```python
application.add_handler(MessageHandler(filters.PHOTO, handle_photo))
application.add_handler(MessageHandler(filters.Document.ALL, handle_document))
application.add_handler(MessageHandler(filters.AUDIO, handle_audio))
application.add_handler(MessageHandler(filters.VIDEO, handle_video))
application.add_handler(MessageHandler(filters.VOICE, handle_voice))
```

### 4. –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª–æ–≤

#### –§–æ—Ç–æ:
```python
photo = message.photo[-1]
width = photo.width
height = photo.height
file_size = photo.file_size
file_id = photo.file_id
```

#### –î–æ–∫—É–º–µ–Ω—Ç:
```python
document = message.document
file_name = document.file_name
mime_type = document.mime_type  # 'application/pdf', 'text/plain', etc.
file_size = document.file_size
```

#### –ê—É–¥–∏–æ:
```python
audio = message.audio
duration = audio.duration  # –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
performer = audio.performer
title = audio.title
file_name = audio.file_name
```

#### –í–∏–¥–µ–æ:
```python
video = message.video
duration = video.duration
width = video.width
height = video.height
file_size = video.file_size
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ò–ò-–º–æ–¥–µ–ª—è–º–∏

### 1. –ö–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–µ –∑—Ä–µ–Ω–∏–µ (PyTorch/TensorFlow)

```python
from PIL import Image
import torch
from torchvision import models, transforms

@router.message(F.photo)
async def classify_image(message: Message, bot: Bot):
    # –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–æ—Ç–æ
    photo = message.photo[-1]
    file_path = Path("temp.jpg")
    await bot.download(photo, destination=file_path)

    # –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    image = Image.open(file_path)

    # –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞
    preprocess = transforms.Compose([
        transforms.Resize(256),
        transforms.CenterCrop(224),
        transforms.ToTensor(),
    ])
    input_tensor = preprocess(image).unsqueeze(0)

    # –ó–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥–µ–ª—å
    model = models.resnet50(pretrained=True)
    model.eval()

    # –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ
    with torch.no_grad():
        output = model(input_tensor)

    await message.answer(f"–†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ: {get_class_name(output)}")
```

### 2. OCR (Tesseract/EasyOCR)

```python
import easyocr

reader = easyocr.Reader(['ru', 'en'])

@router.message(F.photo)
async def extract_text(message: Message, bot: Bot):
    # –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–æ—Ç–æ
    photo = message.photo[-1]
    file_path = Path("temp.jpg")
    await bot.download(photo, destination=file_path)

    # –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç
    result = reader.readtext(str(file_path))
    text = "\n".join([item[1] for item in result])

    await message.answer(f"üìù –†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:\n\n{text}")
```

### 3. Speech-to-Text (Whisper)

```python
import whisper

model = whisper.load_model("base")

@router.message(F.voice)
async def transcribe_voice(message: Message, bot: Bot):
    # –°–∫–∞—á–∏–≤–∞–µ–º –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    voice = message.voice
    file_path = Path("temp.ogg")
    await bot.download(voice, destination=file_path)

    # –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ–º
    result = model.transcribe(str(file_path), language='ru')
    text = result["text"]

    await message.answer(f"üé§ –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è:\n\n{text}")
```

### 4. PDF –æ–±—Ä–∞–±–æ—Ç–∫–∞ (PyPDF2)

```python
import PyPDF2

@router.message(F.document)
async def extract_pdf_text(message: Message, bot: Bot):
    document = message.document

    if document.mime_type == "application/pdf":
        # –°–∫–∞—á–∏–≤–∞–µ–º PDF
        file_path = Path("temp.pdf")
        await bot.download(document, destination=file_path)

        # –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç
        with open(file_path, 'rb') as file:
            reader = PyPDF2.PdfReader(file)
            text = ""
            for page in reader.pages:
                text += page.extract_text()

        await message.answer(f"üìÑ –ò–∑–≤–ª–µ—á–µ–Ω–æ {len(text)} —Å–∏–º–≤–æ–ª–æ–≤")
```

### 5. –í–∏–¥–µ–æ –æ–±—Ä–∞–±–æ—Ç–∫–∞ (OpenCV)

```python
import cv2

@router.message(F.video)
async def analyze_video(message: Message, bot: Bot):
    # –°–∫–∞—á–∏–≤–∞–µ–º –≤–∏–¥–µ–æ
    video = message.video
    file_path = Path("temp.mp4")
    await bot.download(video, destination=file_path)

    # –û—Ç–∫—Ä—ã–≤–∞–µ–º –≤–∏–¥–µ–æ
    cap = cv2.VideoCapture(str(file_path))
    frame_count = int(cap.get(cv2.CAP_PROP_FRAME_COUNT))
    fps = int(cap.get(cv2.CAP_PROP_FPS))

    # –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–∞–¥—Ä—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
    frames = []
    while cap.isOpened():
        ret, frame = cap.read()
        if not ret:
            break
        frames.append(frame)

    cap.release()

    await message.answer(
        f"üé¨ –í–∏–¥–µ–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ:\n"
        f"–ö–∞–¥—Ä–æ–≤: {frame_count}\n"
        f"FPS: {fps}\n"
        f"–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: {frame_count/fps:.1f} —Å–µ–∫"
    )
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

```
downloads/
‚îú‚îÄ‚îÄ photos/           # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ photo_123_abcd1234.jpg
‚îÇ   ‚îî‚îÄ‚îÄ photo_124_efgh5678.jpg
‚îú‚îÄ‚îÄ documents/        # –î–æ–∫—É–º–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ report.pdf
‚îÇ   ‚îî‚îÄ‚îÄ data.csv
‚îú‚îÄ‚îÄ audio/           # –ê—É–¥–∏–æ—Ñ–∞–π–ª—ã –∏ –≥–æ–ª–æ—Å–æ–≤—ã–µ
‚îÇ   ‚îú‚îÄ‚îÄ song.mp3
‚îÇ   ‚îî‚îÄ‚îÄ voice_125.ogg
‚îî‚îÄ‚îÄ video/           # –í–∏–¥–µ–æ—Ñ–∞–π–ª—ã
    ‚îú‚îÄ‚îÄ clip.mp4
    ‚îî‚îÄ‚îÄ video_note_126.mp4
```

## –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Telegram Bot API

1. **–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤:**
   - –û–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: 20 –ú–ë
   - Premium –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: 50 –ú–ë
   - –§–æ—Ç–æ (—Å–∂–∞—Ç—ã–µ): 10 –ú–ë

2. **–°–∫–æ—Ä–æ—Å—Ç—å:**
   - –õ–∏–º–∏—Ç –Ω–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

3. **–•—Ä–∞–Ω–µ–Ω–∏–µ:**
   - –§–∞–π–ª—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö Telegram –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è
   - –°–∫–∞—á–∏–≤–∞–π—Ç–µ –≤–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã —Å—Ä–∞–∑—É

### ‚ö†Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

```python
# –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ MIME-—Ç–∏–ø—ã
ALLOWED_MIMES = ['image/jpeg', 'image/png', 'application/pdf']

if document.mime_type not in ALLOWED_MIMES:
    await message.answer("‚ùå –ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞")
    return

# –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–∞–∑–º–µ—Ä
MAX_SIZE = 10 * 1024 * 1024  # 10 –ú–ë

if document.file_size > MAX_SIZE:
    await message.answer("‚ùå –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π")
    return

# –°–∞–Ω–∏—Ç–∏–∑–∏—Ä—É–π—Ç–µ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤
import re
safe_name = re.sub(r'[^\w\s.-]', '', document.file_name)
```

### ‚ö†Ô∏è –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

```python
# –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ —Ñ–æ–Ω–µ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
import asyncio

@router.message(F.video)
async def process_video_async(message: Message, bot: Bot):
    await message.answer("‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞—á–∞–ª–∞—Å—å...")

    # –ó–∞–ø—É—Å–∫–∞–µ–º –≤ —Ñ–æ–Ω–µ
    asyncio.create_task(process_video_task(message, bot))

async def process_video_task(message: Message, bot: Bot):
    # –î–æ–ª–≥–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
    ...
    await bot.send_message(
        message.chat.id,
        "‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
    )
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –î–∞—Ç–∞—Å–µ—Ç –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏

```python
# –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –º–µ—Ç–∫–∞–º–∏
@router.message(F.photo)
async def save_to_dataset(message: Message, bot: Bot):
    photo = message.photo[-1]
    caption = message.caption or "unlabeled"

    # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è –∫–ª–∞—Å—Å–∞
    class_dir = DOWNLOAD_DIR / "dataset" / caption
    class_dir.mkdir(parents=True, exist_ok=True)

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º
    file_path = class_dir / f"{message.message_id}.jpg"
    await bot.download(photo, destination=file_path)

    await message.answer(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–ª–∞—Å—Å '{caption}'")
```

### Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞

```python
# –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
pending_files = []

@router.message(F.photo)
async def collect_photos(message: Message, bot: Bot):
    pending_files.append(message.photo[-1])
    await message.answer(f"üì∏ –§–∞–π–ª {len(pending_files)} –¥–æ–±–∞–≤–ª–µ–Ω")

@router.message(Command("process"))
async def process_batch(message: Message, bot: Bot):
    await message.answer(f"‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞ {len(pending_files)} —Ñ–∞–π–ª–æ–≤...")

    for photo in pending_files:
        # –û–±—Ä–∞–±–æ—Ç–∫–∞...
        pass

    pending_files.clear()
    await message.answer("‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")
```

## Best Practices

1. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ç–∏–ø—ã –∏ —Ä–∞–∑–º–µ—Ä—ã** –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
2. **–£–¥–∞–ª—è–π—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã** –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ async** –¥–ª—è –¥–æ–ª–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
4. **–õ–æ–≥–∏—Ä—É–π—Ç–µ –æ—à–∏–±–∫–∏** –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —Ñ–∞–π–ª–∞–º–∏
5. **–°–∂–∏–º–∞–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
6. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã** –¥–ª—è UX
7. **–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–π—Ç–µ concurrent –∑–∞–≥—Ä—É–∑–∫–∏**

## –î–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ

- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ–±–ª–∞—á–Ω—ã–º–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞–º–∏ (S3, Google Drive)
- –û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á (Celery, RQ)
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (Redis)
- –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ (–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã)
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (Prometheus)
